var shiftHeld=!1,body,loader,dialog_max_width=964,comfirm_dialog;$(document).ready(function(){body=$("body"),body.on("ajax:beforeSend","a[data-remote], form[data-remote]",function(e,t,n){attachLoading("body")}).on("ajax:complete",function(e,t,n){removeLoading("body")}).on("click","a.remove_fields",function(){return $(this).prev("input[type=hidden]").val("1"),$(this).closest(".fields").hide(),!1}).on("change",".observe_field",function(){target=$(this).attr("data-update"),ajax_indicator=$(this).attr("data-ajax-indicator")||"#busy_indicator",$(target).hide(),$(ajax_indicator).show(),$.ajax({dataType:"html",url:$(this).attr("data-base-url")+encodeURIComponent($(this).val()),type:"get",success:function(e){$(target).html(e),$(ajax_indicator).hide(),$(target).show()}})}),add_fields=function(e,t,n){var r=(new Date).getTime(),i=new RegExp("new_"+t,"g");$(e).append(n.replace(i,r))},$.rails.allowAction=function(e){var t=e.data("confirm"),n=!1,r;return t?($.rails.fire(e,"confirm")&&(bootbox.setIcons({CONFIRM:"icon-trash icon-white"}),bootbox.confirm(t,"Non annuler","Oui supprimer",function(t){if(t){$.rails.fire(e,"confirm:complete",[n]);var r=$.rails.allowAction;$.rails.allowAction=function(){return!0},e.trigger("click"),$.rails.allowAction=r}bootbox.setIcons(null)})),!1):!0},parent&&parent.document.location.href!=document.location.href&&$("body#dialog_container.dialog").addClass("iframed"),$("ul.wym_tools a, li.wym_tools_class a:first").each(function(){$(this).attr("rel","tooltip").html("")}),$('a[rel="tooltip"], a[rel="tooltip nofollow"]').tooltip(),$('input[rel="popover"]').popover(),$(".btn.toggle").on("click",function(e){e.preventDefault(),$($(this).attr("href")).toggle()}),$.datepicker.setDefaults($.datepicker.regional.fr),$("input.date_picker, input.date, input.datetime").datepicker({dateFormat:"DD d MM yy"}),init_text_editor(),init_modal_dialogs(),init_images(),$("textarea.wysihtml5").wysihtml5({stylesheets:"/assets/gko_wysihtml5_body.css"})}),close_dialog=function(e){iframed()?(the_body=$(parent.document.body),the_dialog=parent.$(".ui-dialog-content")):(the_body=$(document.body).removeClass("hide-overflow"),the_dialog=$(".ui-dialog-content"),the_dialog.filter(":data(dialog)").dialog("close"),the_dialog.remove()),$(document.body).hasClass("wym_iframe_body")||(the_body.removeClass("hide-overflow"),the_dialog.filter(":data(dialog)").dialog("close"),the_dialog.remove(),e.preventDefault())};